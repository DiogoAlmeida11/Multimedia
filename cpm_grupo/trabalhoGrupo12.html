<<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Projeto-CPM</title>
    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.0/dist/aframe-extras.min.js"></script>
    <script src="//cdn.rawgit.com/donmccurdy/aframe-extras/v3.13.1/dist/aframe-extras.min.js"></script>
    <script>
        $ = (sel) => document.querySelector(sel)
        $$ = (sel) => document.querySelectorAll(sel)
        on = (elem, type, hand) => elem.addEventListener(type,hand)
    </script>
</head>
<body>
    <a-scene>
        <!-- Audios -->
        <a-sound id="SomAlien" src="https://cdn.glitch.com/c93b3326-8f13-429c-ba61-f5c3f64122db%2FAlien.m4a?v=1587323585459" volume="1.5"></a-sound>
        <a-sound id="SomNave" src="https://cdn.glitch.com/c93b3326-8f13-429c-ba61-f5c3f64122db%2FSomNave.mp3?v=1587385210228" autoplay="true" volume="5" loop="true"></a-sound>
        <a-sound id="SomTiro" src="https://cdn.glitch.com/c93b3326-8f13-429c-ba61-f5c3f64122db%2FSomTiro.mp3?v=1587385389980" volume="2"></a-sound> 
        <a-sound id="MusicaDeFundo" src="https://cdn.glitch.com/c93b3326-8f13-429c-ba61-f5c3f64122db%2FPat%20and%20Janet-MusicaDeFundo.mp3?v=1587385803753" autoplay="true" volume="9"></a-sound> 

        <a-entity id="Planetas&Estrelas" animation__viajar="property: position; dur: 100000; delay:1000; loop: false; to: 0 0 200;">
        <!-- Estrelas 1 -->
        <a-entity id="estrelas1" position ="-483.443 -63.492 -187.175">
            <a-gltf-model
            scale = "5 5 5"
            src="https://cdn.glitch.com/c93b3326-8f13-429c-ba61-f5c3f64122db%2Fspace.glb?v=1587144441146"></a-gltf-model>
        </a-entity>
        
        <!-- Estrelas 2 -->
        <a-entity id="estrelas2" position ="-483.443 -63.492 387.175">
            <a-gltf-model
            scale = "5 5 5"
            src="https://cdn.glitch.com/c93b3326-8f13-429c-ba61-f5c3f64122db%2Fspace.glb?v=1587144441146"></a-gltf-model>
        </a-entity>
       
        <!-- Neptuno -->
        <a-entity id="neptuno" position="25 2 -190" animation__spin="property: rotation; dur: 62000; loop: true; to: 0 1490 0;">
            <a-gltf-model 
            scale = "2.5 2.5 2.5"
            src="https://cdn.glitch.com/c93b3326-8f13-429c-ba61-f5c3f64122db%2Fneptuno.glb?v=1587243176425" animation-mixer></a-gltf-model>
        </a-entity>

        <!-- Urano -->
        <a-entity id="urano" position="55 2 -145" animation__spin="property: rotation; dur: 62000; loop: true; to: 0 1490 0;">
            <a-gltf-model 
            scale = "2.5 2.5 2.5"
            src="https://cdn.glitch.com/c93b3326-8f13-429c-ba61-f5c3f64122db%2Furano.glb?v=1587241506240" animation-mixer></a-gltf-model>
        </a-entity>

         <!-- Saturno -->
         <a-entity id="saturno" position="-33 2 -105" rotation="0 0 20"animation__spin="property: rotation; dur: 82000; loop: true; to: 0 1490 0;">
            <a-gltf-model 
            scale = "5 5 5"
            src="https://cdn.glitch.com/c93b3326-8f13-429c-ba61-f5c3f64122db%2Fsaturno.glb?v=1587241025301" animation-mixer></a-gltf-model>
        </a-entity>

        <!-- Jupiter -->
        <a-entity id="jupiter" position="-37 2 -55" animation__spin="property: rotation; dur: 92000; loop: true; to: 0 1490 0;">
            <a-gltf-model 
            scale = "6 6 6"
            src="https://cdn.glitch.com/c93b3326-8f13-429c-ba61-f5c3f64122db%2Fjupiter.glb?v=1587239955091" animation-mixer></a-gltf-model>
        </a-entity>

        <!-- Marte -->
        <a-entity id="marte" position="-26 1.5 -10" animation__spin="property: rotation; dur: 62000; loop: true; to: 0 1490 0;">
            <a-gltf-model 
            scale = "2 2 2"
            src="https://cdn.glitch.com/c93b3326-8f13-429c-ba61-f5c3f64122db%2Fmars.glb?v=1587239473893" animation-mixer></a-gltf-model>
        </a-entity>

        <!-- Sol -->
        <a-entity id="sol" position="10.902 1.5 40" animation__spin="property: rotation; dur: 62000; loop: true; to: 0 1490 0;">
            <a-gltf-model 
            scale = "0.2 0.2 0.2"
            src="https://cdn.glitch.com/c93b3326-8f13-429c-ba61-f5c3f64122db%2Fsun.glb?v=1587144421562"></a-gltf-model>
        </a-entity>

        <!-- Lua -->
        <a-entity id="lua" position ="-8 1.882 20.765" animation__spin="property: rotation; dur: 62000; loop: true; to: 0 1490 0;">
            <a-gltf-model
            scale = "1 1 1"
            src="https://cdn.glitch.com/c93b3326-8f13-429c-ba61-f5c3f64122db%2Flua.glb?v=1587393141137"></a-gltf-model>
        </a-entity>

        <!-- Terra -->
        <a-entity id="terra" position ="0 -1 16.765" animation__spin="property: rotation; dur: 82000; loop: true; to: 0 1490 0;">
            <a-gltf-model
            scale = "0.03 0.03 0.03"
            src="https://cdn.glitch.com/c93b3326-8f13-429c-ba61-f5c3f64122db%2Fearth.glb?v=1587128473106"></a-gltf-model>
        </a-entity>

        <a-light type="spot" color="#ffffff" intensity="1.110" angle="-90" rotation="0 -180.000 0" position="0 2.971 9.525" distance="21.401"></a-light>
        <a-light type="spot" color="#0080ff" intensity="16.660" angle="-165.520" rotation="0 -180.000 0" position="3.646 10.515 23.731" distance="13.451"></a-light>

        <!-- Asteroide -->
        <a-entity id="asteroide" position ="-35 2 -170" animation__spin="property: rotation; dur: 52000; loop: true; to: 0 1490 0;">
            <a-gltf-model
            scale = "1.5 1.5 1.5"
            src="https://cdn.glitch.com/c93b3326-8f13-429c-ba61-f5c3f64122db%2Fasteroide.glb?v=1587306728178"></a-gltf-model>
        </a-entity>            
    </a-entity>

        <!-- Inimigo -->
        <a-entity id='ball'
          position="0 -10 0"
          dynamic-body>
            <a-gltf-model animation__rotacao="property: rotation;
            from: 0 0 0;
            to: -360 0 0;
            loop: true;
            dur: 500;
            easing: linear"
            scale = "0.1 0.1 0.1"
            src="https://cdn.glitch.com/c93b3326-8f13-429c-ba61-f5c3f64122db%2Falien.glb?v=1587126993295"></a-gltf-model>
        </a-entity>

        <!-- Alienship -->
        <a-entity id="alienship" position ="0 -1 -24.012" rotation="0 30.000 0" >
            <a-gltf-model
            scale = "1.800 1.800 1.800"
            src="https://cdn.glitch.com/c93b3326-8f13-429c-ba61-f5c3f64122db%2Falienship.glb?v=1587307790615"></a-gltf-model>
        </a-entity>

        <!-- Nave -->
        <a-gltf-model id="nave" position="0 0.292 13.96"
        scale="0.100 0.100 0.100"
        rotation = "0 229.650 0"
        src="https://cdn.glitch.com/c93b3326-8f13-429c-ba61-f5c3f64122db%2Fspacecraft.glb?v=1587077313206"></a-gltf-model>

        <!-- Fogo Nave -->
        <a-gltf-model id="fogo" position="-0.006 1.691 14.476"
        scale="0.021 0.011 0.041"
        rotation = "0 90.000  90.000"
        src="https://cdn.glitch.com/c93b3326-8f13-429c-ba61-f5c3f64122db%2Ffire.glb?v=1587241901579" animation-mixer></a-gltf-model>

        <!-- Tiro -->
        <a-entity id="PosTiro" position="-0.049 -10 14.024" rotation= "0 0 0" dynamic-body>
          <a-sphere id="tiro" color="red"  position="-0.007 -0.01 -5.075" scale="1 1 1"></a-sphere>
          </a-entity>

        <!-- Jogador -->
        <a-entity  id="camera" camera="active: true" look-controls position="0.001 1.792 13.850" scale="1 1 1">
            <a-light type="point" color="white" intensity="1" distance="2.370"></a-light>
            <a-text id="score" value="Score" position="-0.2 0.7 -1" color="red" width="2" anchor="left"></a-text>
            <a-entity  position="0.096 -0.067 -0.009" scale="0.500 0.500 0.500">
                <a-light type="point" color="white" intensity="1" distance="2.370"></a-light>
                <a-gltf-model id='weapon'
                scale="0.100 0.100 0.100"
                rotation = "-0.003 -106.442 0.015"
                src="https://cdn.glitch.com/c93b3326-8f13-429c-ba61-f5c3f64122db%2Farma.glb?v=1587121546430" static-body></a-gltf-model>
            </a-entity>
        </a-entity>

         <!-- Luz Ambiente -->
        <a-entity position="0.003 20 14.100" scale="1 1 1" rotation="-85.259 0 0">
            <a-light type="directional" color="white" intensity="1.8"></a-light>
        </a-entity>
        
       
        <!-- Céu -->
        <a-sky color="black"></a-sky>
    </a-scene>

    <script>

        /**
         * Função lançar cabeças de Alien com física
        */

        let vidas = 3;
        let hit = false
        let resetId = 0
        const resetBall = () => {
            clearTimeout(resetId)
            $("#ball").body.position.set(0, 1,-50)
            $("#ball").body.velocity.set(0, 13, 25)
            $("#ball").body.angularVelocity.set(0, 0, 0)
            hit = false
            resetId = setTimeout(resetBall,6000)
        }
            on($("#weapon"),'collide',(e)=>{
                const ball = $("#ball")
                if(e.detail.body.id === ball.body.id && !hit) {
                    hit = true
                    vidas = vidas - 1
                    $("#vidas").setAttribute('text','value','Vidas ' + vidas)
                    clearTimeout(resetId)
                    resetId = setTimeout(resetBall,4000)
                }
            })
        setTimeout(resetBall,3000)

        /**
         * Função Disparar e contar Score
        */

        let score = 0;
        let SomAlien = document.querySelector('#SomAlien');
        let SomTiro = document.querySelector('#SomTiro');

        document.querySelector('a-scene').addEventListener('mousedown', function () {
        SomTiro.components.sound.stopSound();
        SomTiro.components.sound.playSound();
        let pcamera = document.querySelector('#camera').getAttribute('rotation')
        console.log(pcamera);
        
        $("#PosTiro").setAttribute('rotation', pcamera);
        $("#PosTiro").body.position.set(-0.049, 1.780, 14.024)
        $("#PosTiro").body.velocity.set(0, 50, -200)

        let posTiro = document.querySelector('#PosTiro').getAttribute('rotation')

        on($("#PosTiro"),'collide',(e)=>{
            const ball = $("#ball")
            if(e.detail.body.id === ball.body.id && !hit) {
                SomAlien.components.sound.playSound();
                hit = true
                score = score + 1
                $("#score").setAttribute('text','value','Score '+score)
                clearTimeout(resetId)
                resetId = setTimeout(resetBall,2000)
            }
        })
        });
    </script>
</body>
</html>